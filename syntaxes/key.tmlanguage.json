{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "injectionSelector": "L:source.namu",
  "name": "Namuwiki Code",
  "scopeName": "source.namu",
  "patterns": [
    {
      "include": "#wiki-patterns"
    }
  ],
  "repository": {
    "wiki-patterns": {
      "patterns": [
        {
          "include": "#comments"
        },
        {
          "include": "#links"
        },
        {
          "include": "#includes"
        },
        {
          "include": "#rubys"
        },
        {
          "include": "#anchors"
        },
        {
          "include": "#math"
        },
        {
          "include": "#macros"
        },
        {
          "include": "#titles"
        },
        {
          "include": "#markups"
        },
        {
          "include": "#lists"
        },
        {
          "include": "#brackets"
        },
        {
          "include": "#footnotes"
        },
        {
          "include": "#redirect"
        },
        {
          "include": "#tables"
        }
      ]
    },
    "comments": {
      "name": "comment.line.double-quote.namu",
      "match": "#{2,}.*"
    },
    "titles": {
      "name": "keyword.control.namu",
      "match": "^(={1,6})(#?) (.*) (\\2)(\\1)$"
    },
    "links": {
      "match": "\\[{2}([^|\\]\\[]*)((\\|)([^|\\]\\[]*))?\\]{2}",
      "captures": {
        "1": {
          "name": "string.quoted.double.namu"
        },
        "4": {
          "name": "support.constant.namu"
        }
      }
    },
    "includes": {
      "begin": "\\[(include)\\(",
      "beginCaptures": {
        "1": { "name": "keyword.control.include.namu" }
      },
      "end": "\\)\\]",
      "patterns": [
        {
          "match": "((?:\\.|[^,=\\)\\]])+)(?:=((?:\\\\.|[^,\\)\\]])+))?(?:,(?![^\\\\]))?",
          "captures": {
            "1": { "name": "variable.parameter.key.namu" },
            "2": { "name": "string.unquoted.argument.namu" }
          }
        }
      ]
    },
    "rubys": {
      "begin": "\\[(?=ruby)",
      "end": "\\]",
      "patterns": [
        {
          "name": "keyword.control.namu",
          "match": "ruby(?=\\()"
        },
        {
          "name": "string.quoted.double.namu",
          "match": "(?<=ruby\\().[^\\,]*(\\){1,})?(?=,)"
        },
        {
          "name": "variable.parameter.namu",
          "match": "(?<=\\,)[^\\=]*(?=\\=)"
        },
        {
          "name": "string.quoted.double.namu",
          "match": "(?<=ruby\\=)[^\\)\\]]*(\\){1,})?(?=\\)\\])"
        }
      ]
    },
    "anchors": {
      "match": "\\[((anchor|age|dday|youtube|kakaotv|niconicovideo|vimeo|nicovideo|navertv)\\(([^\\)]*(\\){1,})?)\\)|(pagecount)(\\(([^\\)]*(\\){1,})?)\\))?)\\]",
      "captures": {
        "2": {
          "name": "keyword.control.namu"
        },
        "3": {
          "name": "variable.parameter.namu"
        },
        "5": {
          "name": "keyword.control.namu"
        },
        "7": {
          "name": "variable.parameter.namu"
        }
      }
    },
    "math": {
      "begin": "\\[((?=math))",
      "end": "\\]",
      "patterns": [
        {
          "name": "keyword.control.namu",
          "match": "math(?=\\()"
        },
        { "include": "text.katex" }
      ]
    },
    "macros": {
      "begin": "\\[(?=clearfix|date|datetime|목차|tableofcontents|각주|footnote|br)",
      "end": "\\]",
      "patterns": [
        {
          "name": "keyword.control.namu",
          "match": "clearfix|date|datetime|목차|tableofcontents|각주|footnote|br"
        }
      ]
    },
    "markups": {
      "patterns": [
        {
          "name": "markup.bold.namu",
          "match": "'''[^']*'''"
        },
        {
          "name": "markup.italic.namu",
          "match": "(''[^']*''|__[^_]*__)"
        },
        {
          "name": "keyword.control.namu",
          "match": "-{4,9}"
        },
        {
          "name": "keyword.operator.namu",
          "match": "^(> ?){1,8}"
        }
      ]
    },
    "lists": {
      "patterns": [
        {
          "name": "keyword.operator.namu",
          "match": "(?<=^(> ?){0,8} ( )*)(\\*|1\\.|a\\.|A\\.|i\\.|I\\.(\\#[0-9][0-9]?)?)"
        }
      ]
    },
    "brackets": {
      "name": "meta.block.special.namu",
      "begin": "(\\{\\{\\{)",
      "beginCaptures": {
        "1": { "name": "punctuation.section.block.begin.namu" }
      },
      "end": "(\\}\\}\\})",
      "endCaptures": {
        "1": { "name": "punctuation.section.block.end.namu" }
      },
      "patterns": [
        {
          "match": "(?<!^\\s*)(\\+[0-9]|#[A-Fa-f0-9]{3,6}(?:,#[A-Fa-f0-9]{3,6})?)(?=\\s|$)",
          "captures": { "1": { "name": "support.constant.color.namu" } }
        },
        {
          "match": "(?i)(?<!^\\s*)(#(?:AliceBlue|AntiqueWhite|Aqua|Aquamarine|Azure|Beige|Bisque|Black|BlanchedAlmond|Blue|BlueViolet|Brown|BurlyWood|CadetBlue|Chartreuse|Chocolate|Coral|CornflowerBlue|Cornsilk|Crimson|Cyan|DarkBlue|DarkCyan|DarkGoldenRod|DarkGray|DarkGrey|DarkGreen|DarkKhaki|DarkMagenta|DarkOliveGreen|DarkOrange|DarkOrchid|DarkRed|DarkSalmon|DarkSeaGreen|DarkSlateBlue|DarkSlateGray|DarkSlateGrey|DarkTurquoise|DarkViolet|DeepPink|DeepSkyBlue|DimGray|DimGrey|DodgerBlue|FireBrick|FloralWhite|ForestGreen|Fuchsia|Gainsboro|GhostWhite|Gold|GoldenRod|Gray|Grey|Green|GreenYellow|HoneyDew|HotPink|IndianRed|Indigo|Ivory|Khaki|Lavender|LavenderBlush|LawnGreen|LemonChiffon|LightBlue|LightCoral|LightCyan|LightGoldenRodYellow|LightGray|LightGrey|LightGreen|LightPink|LightSalmon|LightSeaGreen|LightSkyBlue|LightSlateGray|LightSlateGrey|LightSteelBlue|LightYellow|Lime|LimeGreen|Linen|Magenta|Maroon|MediumAquaMarine|MediumBlue|MediumOrchid|MediumPurple|MediumSeaGreen|MediumSlateBlue|MediumSpringGreen|MediumTurquoise|MediumVioletRed|MidnightBlue|MintCream|MistyRose|Moccasin|NavajoWhite|Navy|OldLace|Olive|OliveDrab|Orange|OrangeRed|Orchid|PaleGoldenRod|PaleGreen|PaleTurquoise|PaleVioletRed|PapayaWhip|PeachPuff|Peru|Pink|Plum|PowderBlue|Purple|RebeccaPurple|Red|RosyBrown|RoyalBlue|SaddleBrown|Salmon|SandyBrown|SeaGreen|SeaShell|Sienna|Silver|SkyBlue|SlateBlue|SlateGray|SlateGrey|Snow|SpringGreen|SteelBlue|Tan|Teal|Thistle|Tomato|Turquoise|Violet|Wheat|White|WhiteSmoke|Yellow|YellowGreen)(?:,#(?:AliceBlue|AntiqueWhite|Aqua|Aquamarine|Azure|Beige|Bisque|Black|BlanchedAlmond|Blue|BlueViolet|Brown|BurlyWood|CadetBlue|Chartreuse|Chocolate|Coral|CornflowerBlue|Cornsilk|Crimson|Cyan|DarkBlue|DarkCyan|DarkGoldenRod|DarkGray|DarkGrey|DarkGreen|DarkKhaki|DarkMagenta|DarkOliveGreen|DarkOrange|DarkOrchid|DarkRed|DarkSalmon|DarkSeaGreen|DarkSlateBlue|DarkSlateGray|DarkSlateGrey|DarkTurquoise|DarkViolet|DeepPink|DeepSkyBlue|DimGray|DimGrey|DodgerBlue|FireBrick|FloralWhite|ForestGreen|Fuchsia|Gainsboro|GhostWhite|Gold|GoldenRod|Gray|Grey|Green|GreenYellow|HoneyDew|HotPink|IndianRed|Indigo|Ivory|Khaki|Lavender|LavenderBlush|LawnGreen|LemonChiffon|LightBlue|LightCoral|LightCyan|LightGoldenRodYellow|LightGray|LightGrey|LightGreen|LightPink|LightSalmon|LightSeaGreen|LightSkyBlue|LightSlateGray|LightSlateGrey|LightSteelBlue|LightYellow|Lime|LimeGreen|Linen|Magenta|Maroon|MediumAquaMarine|MediumBlue|MediumOrchid|MediumPurple|MediumSeaGreen|MediumSlateBlue|MediumSpringGreen|MediumTurquoise|MediumVioletRed|MidnightBlue|MintCream|MistyRose|Moccasin|NavajoWhite|Navy|OldLace|Olive|OliveDrab|Orange|OrangeRed|Orchid|PaleGoldenRod|PaleGreen|PaleTurquoise|PaleVioletRed|PapayaWhip|PeachPuff|Peru|Pink|Plum|PowderBlue|Purple|RebeccaPurple|Red|RosyBrown|RoyalBlue|SaddleBrown|Salmon|SandyBrown|SeaGreen|SeaShell|Sienna|Silver|SkyBlue|SlateBlue|SlateGray|SlateGrey|Snow|SpringGreen|SteelBlue|Tan|Teal|Thistle|Tomato|Turquoise|Violet|Wheat|White|WhiteSmoke|Yellow|YellowGreen))?)(?=\\s|$)",
          "captures": { "1": { "name": "support.constant.color.namu" } }
        },
        {
          "match": "(#!folding\\s*)(.*)",
          "captures": {
            "1": { "name": "keyword.control.bracket.namu" },
            "2": { "name": "string.quoted.other.namu" }
          }
        },
        {
          "match": "(#!wiki)(?:\\s+(?:(?:(style)=\\\"([^\"]*)\\\"(?:\\s+(dark-style)=\\\"([^\"]*)\\\")?)|(?:(dark-style)=\\\"([^\"]*)\\\"(?:\\s+(style)=\\\"([^\"]*)\\\")?)))?",
          "captures": {
            "1": { "name": "keyword.control.bracket.namu" },
            "2": { "name": "variable.parameter.bracket.namu" },
            "3": { "name": "meta.embedded.line.css", "patterns": [{ "include": "#wiki-style-line-css" }] },
            "4": { "name": "variable.parameter.bracket.namu" },
            "5": { "name": "meta.embedded.line.css", "patterns": [{ "include": "#wiki-style-line-css" }] },
            "6": { "name": "variable.parameter.bracket.namu" },
            "7": { "name": "meta.embedded.line.css", "patterns": [{ "include": "#wiki-style-line-css" }] },
            "8": { "name": "variable.parameter.bracket.namu" },
            "9": { "name": "meta.embedded.line.css", "patterns": [{ "include": "#wiki-style-line-css" }] }
          }
        },
        {
          "name": "meta.embedded.block.html",
          "begin": "(#!html)",
          "beginCaptures": {
            "1": { "name": "keyword.control.bracket.namu" }
          },
          "end": "(?=\\})",
          "patterns": [{ "include": "text.html.derivative" }]
        },
        {
          "match": "(#!syntax)\\s+(basic|cpp|csharp|css|erlang|go|java(script)?|json|kotlin|lisp|lua|markdown|objectivec|perl|php|powershell|python|ruby|rust|sh|sql|swift|typescript|xml)",
          "captures": {
            "1": { "name": "keyword.control.bracket.namu" },
            "2": { "name": "support.function.language-name.namu" }
          }
        },
        {
          "name": "meta.embedded.block.javascript",
          "begin": "(#!if)",
          "beginCaptures": {
            "1": { "name": "keyword.control.bracket.namu" }
          },
          "end": "(?=\\n)",
          "patterns": [
            {
              "include": "source.js"
            }
          ]
        }
      ]
    },
    "footnotes": {
      "match": "\\[(\\*)",
      "captures": {
        "1": {
          "name": "keyword.operator.namu"
        }
      }
    },
    "redirect": {
      "match": "^(#redirect) (.*)",
      "captures": {
        "1": {
          "name": "keyword.control.namu"
        },
        "2": {
          "name": "string.quoted.double.namu"
        }
      }
    },
    "tables": {
      "begin": "\\|\\|",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.table.namu" }
      },
      "end": "(?= |\n|$)",
      "patterns": [
        {
          "match": "(<)([^>=|]*(?:\\|[^>=|]+)?)(?:=([^>|]*))?(>)",
          "captures": {
            "1": {
              "name": "punctuation.definition.tag.begin.namu"
            },
            "2": {
              "name": "entity.other.attribute-name.table.namu"
            },
            "3": {
              "name": "string.unquoted.attribute-value.table.namu"
            },
            "4": {
              "name": "punctuation.definition.tag.end.namu"
            }
          }
        }
      ]
    },
    "wiki-style-line-css": {
      "match": "([-a-zA-Z0-9]+)\\s*:\\s*([^;]+)(?:;|$)",
      "captures": {
        "1": { "name": "support.type.property-name.css" },
        "2": { "name": "constant.numeric.css" }
      }
    }
  }
}
